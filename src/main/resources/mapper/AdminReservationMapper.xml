<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.HiMade.admin.mapper.AdminReservationMapper">
    <select id="getList" resultType="com.example.HiMade.admin.dto.adminReservationDTO">
        select c.category_id, c.category_level, c.parent_category_id, c.service_name , c.service_price, c.service_content, c.store_id, ci.image_url
        from category c
        left join category_image ci
        on c.category_id = ci.category_id
        where category_level = 1
        ORDER BY c.category_id DESC
    </select>

    <select id="getManageList" resultType="com.example.HiMade.admin.dto.adminReserveMangeDTO">
        select * from reservation
    </select>

    <select id="getListDetail" resultType="com.example.HiMade.admin.dto.adminReservationDTO">
        select c.category_id, c.category_level, c.parent_category_id, c.service_name , c.service_price, c.service_content, c.store_id, ci.image_url
        from category c
        left join category_image ci
        on c.category_id = ci.category_id
        where c.category_level = 1 AND  c.category_id = #{id}
    </select>

    <select id="getMiddleItem" resultType="com.example.HiMade.admin.dto.adminRSDTO">
        select c.category_id, c.category_level, c.parent_category_id, c.service_name , c.service_price, c.service_content, c.store_id, sc.category_status, sc.category_id, sc.sub_category_type, sc.is_required, sc.is_paid
        from category c
        LEFT join sub_category_status sc
        on c.category_id = sc.category_id
        WHERE c.parent_category_id = #{id}  AND c.category_level = 2
    </select>

    <select id="getSubItem" resultType="com.example.HiMade.admin.dto.adminReservationDTO">
        select * from category c
        where parent_category_id = #{id} AND category_level = 3;
    </select>

    <insert id="setCategory">
        INSERT INTO CATEGORY (category_level, parent_category_id, service_name, service_price, service_content, store_id)
        VALUES (#{categoryLevel}, #{parentCategoryId}, #{serviceName}, #{servicePrice}, #{serviceContent}, 1)
    </insert>



    <insert id="setMainCategory" parameterType="com.example.HiMade.admin.dto.adminReservationDTO" useGeneratedKeys="true" keyProperty="categoryId">
        INSERT INTO category (category_level, service_name, service_price, service_content, store_id)
        VALUES (1, #{serviceName}, #{servicePrice}, #{serviceContent}, 1)
        RETURNING category_id
    </insert>

    <insert id="setMainCategory2" parameterType="com.example.HiMade.admin.dto.adminRSDTO" useGeneratedKeys="true" keyProperty="middleId">
        INSERT INTO category (category_level, parent_category_id, service_name, service_price, store_id)
        VALUES (2, #{parentCategoryId}, #{serviceName}, #{servicePrice}, 1)
        RETURNING category_id
    </insert>

    <insert id="setMainCategory3" parameterType="com.example.HiMade.admin.dto.adminRSDTO">
        INSERT INTO sub_category_status (category_id, sub_category_type, is_required, is_paid)
        VALUES (#{middleId}, #{subCategoryType}, #{isRequired}, #{isPaid});
    </insert>

    <insert id="setMainCategory4" parameterType="com.example.HiMade.admin.dto.adminReservationDTO">
        INSERT INTO category (category_level, parent_category_id, service_name, service_price, store_id)
        VALUES (3, #{parentCategoryId}, #{serviceName}, #{servicePrice}, 1)
    </insert>

</mapper>